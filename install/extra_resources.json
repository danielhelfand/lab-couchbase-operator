oc patch configmap %jupyterhub_application%-cfg -o json --dry-run \
  -n %jupyterhub_namespace% --patch '
data:
  extra_resources.json: |-
    { 
      "kind": "List", 
      "apiVersion": "v1", 
      "items": [ 
        { 
          "kind": "ServiceAccount", 
          "apiVersion": "v1", 
          "metadata": { 
            "name": "couchbase-operator" 
          } 
        }, 
        { 
          "kind": "ClusterRoleBinding", 
          "apiVersion": "rbac.authorization.k8s.io/v1beta1", 
          "metadata": { 
            "name": "couchbase-operator-rolebinding" 
          }, 
          "subjects": [ 
            { 
              "kind": "ServiceAccount", 
              "name": "couchbase-operator" 
            } 
          ], 
          "roleRef": { 
            "apiGroup": "rbac.authorization.k8s.io", 
            "kind": "ClusterRole", 
            "name": "couchbase-operator" 
          } 
        }, 
        { 
          "apiVersion": "apps/v1", 
          "kind": "Deployment", 
          "metadata": { 
            "name": "couchbase-operator" 
          }, 
          "spec": { 
            "replicas": 1, 
            "selector": { 
              "matchLabels": { 
                "app": "couchbase-operator" 
              } 
            }, 
            "template": { 
              "metadata": { 
                "labels": { 
                  "app": "couchbase-operator" 
                } 
              }, 
              "spec": { 
                "containers": [ 
                  { 
                    "name": "couchbase-operator", 
                    "image": "couchbase/operator:1.1.0", 
                    "command": [ 
                      "couchbase-operator" 
                    ], 
                    "args": [ 
                      "-enable-upgrades=false" 
                    ], 
                    "env": [ 
                      { 
                        "name": "MY_POD_NAMESPACE", 
                        "valueFrom": { 
                          "fieldRef": { 
                            "fieldPath": "metadata.namespace" 
                          } 
                        } 
                      }, 
                      { 
                        "name": "MY_POD_NAME", 
                        "valueFrom": { 
                          "fieldRef": { 
                            "fieldPath": "metadata.name" 
                          } 
                        } 
                      } 
                    ], 
                    "ports": [ 
                      { 
                        "name": "readiness-port", 
                        "containerPort": 8080 
                      } 
                    ], 
                    "readinessProbe": { 
                      "httpGet": { 
                        "path": "/readyz", 
                        "port": "readiness-port" 
                      }, 
                      "initialDelaySeconds": 3, 
                      "periodSeconds": 3, 
                      "failureThreshold": 19 
                    } 
                  } 
                ], 
                "serviceAccountName": "couchbase-operator" 
              } 
            } 
          } 
        } 
      ] 
    }
'
